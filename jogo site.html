<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ ARENA - MULTIPLAYER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --neon-blue: #00f2ff; --neon-purple: #bc13fe; }
        body { 
            font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; 
            background-image: radial-gradient(circle at 50% -20%, #1e1b4b 0%, #020617 80%);
        }
        .font-gamer { font-family: 'Orbitron', sans-serif; }
        .active-turn { border: 2px solid var(--neon-blue); box-shadow: 0 0 20px rgba(0, 242, 255, 0.4); transform: scale(1.05); }
        .grid-cell { transition: all 0.3s ease; background: linear-gradient(145deg, #0f172a, #1e293b); border: 1px solid rgba(255, 255, 255, 0.05); }
        .grid-cell:hover:not(:disabled) { border-color: var(--neon-blue); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }
        .custom-scroll::-webkit-scrollbar { height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <div id="setup-screen" class="min-h-screen flex items-center justify-center p-6">
        <div class="max-w-md w-full bg-slate-900/90 backdrop-blur-xl p-10 rounded-[2rem] border-2 border-blue-500/30 shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-black text-cyan-400 font-gamer italic tracking-tighter">ARENA LOBBY</h1>
                <p id="host-status" class="text-slate-500 text-[10px] mt-2 uppercase font-bold tracking-widest">Aguardando Jogadores...</p>
            </div>
            
            <div class="space-y-4 mb-8">
                <div class="relative">
                    <input type="text" id="player-input" placeholder="SEU NICKNAME" class="w-full bg-black/50 border-b-2 border-slate-700 p-4 outline-none focus:border-cyan-500 transition font-gamer uppercase">
                    <button onclick="addPlayer()" class="absolute right-2 top-2 bg-cyan-600 p-2 rounded-lg"><span class="material-symbols-outlined">add</span></button>
                </div>
                <div id="player-list" class="space-y-2 max-h-48 overflow-y-auto custom-scroll"></div>
            </div>

            <button id="start-btn" onclick="startGame()" class="hidden w-full bg-cyan-500 text-black py-5 rounded-2xl font-black text-xl hover:bg-white transition-all uppercase font-gamer">
                Iniciar Partida
            </button>
            <p id="wait-message" class="text-center text-slate-500 text-xs italic">Apenas o Dono da Sala pode iniciar.</p>
        </div>
    </div>

    <div id="game-screen" class="hidden flex flex-col min-h-screen">
        <header class="bg-black/60 backdrop-blur-md p-6 sticky top-0 z-40 border-b border-white/10 flex flex-col gap-4">
            <div class="flex justify-between items-center px-4">
                <div class="flex flex-col">
                    <h2 class="text-2xl font-black text-cyan-400 font-gamer italic">QUIZ ARENA</h2>
                    <p id="turn-indicator" class="text-xs font-bold text-purple-400 uppercase tracking-[0.3em]">VEZ DE: ---</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="toggleEditor()" class="text-slate-500 hover:text-white"><span class="material-symbols-outlined">settings</span></button>
                    <button onclick="resetGame()" class="text-red-900 hover:text-red-500"><span class="material-symbols-outlined">restart_alt</span></button>
                </div>
            </div>
            <div id="score-sidebar" class="flex gap-4 overflow-x-auto px-4 pb-2 custom-scroll"></div>
        </header>

        <main class="p-8 overflow-x-auto">
            <div id="quiz-grid" class="grid grid-cols-8 gap-4 min-w-[1200px]"></div>
        </main>
    </div>

    <div id="question-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/95 backdrop-blur-md">
        <div class="bg-slate-900 w-full max-w-5xl rounded-[3rem] border border-white/10 flex flex-col relative overflow-hidden">
            <button onclick="cancelQuestion()" class="absolute top-6 right-8 text-slate-500 hover:text-white z-50"><span class="material-symbols-outlined text-4xl">close</span></button>
            
            <div class="p-8 bg-black/40 border-b border-white/5">
                <span id="modal-category" class="text-purple-500 font-gamer text-xs tracking-widest uppercase">CATEGORIA</span>
                <h3 id="modal-points" class="text-5xl font-black italic text-white">0 PTS</h3>
            </div>

            <div class="p-16 text-center flex-grow flex flex-col items-center justify-center">
                <img id="modal-image" src="" class="hidden max-h-64 rounded-2xl mb-8 border border-white/10">
                <p id="modal-question-text" class="text-4xl font-extrabold text-white leading-tight"></p>
                
                <div id="answer-box" class="hidden w-full mt-10 p-8 bg-cyan-500/10 border-2 border-cyan-500/30 rounded-3xl">
                    <p id="modal-answer-text" class="text-3xl font-black text-cyan-400 uppercase"></p>
                </div>

                <button id="show-answer-btn" onclick="revealAnswer()" class="mt-10 bg-white text-black px-12 py-4 rounded-full font-black text-xl hover:scale-110 transition">REVELAR RESPOSTA</button>
            </div>

            <div id="player-actions" class="hidden p-8 bg-black/60 grid grid-cols-2 md:grid-cols-4 gap-4 border-t border-white/5"></div>
        </div>
    </div>

    <div id="end-screen" class="hidden fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-8 overflow-y-auto">
        <h1 class="text-6xl font-black font-gamer text-white italic mb-12">RESULTADO FINAL</h1>
        <div id="leaderboard" class="w-full max-w-2xl space-y-4 mb-12"></div>
        <button onclick="location.reload()" class="bg-cyan-500 text-black px-12 py-4 rounded-full font-black text-xl">NOVA PARTIDA</button>
    </div>

    <script>
        const cats = ["Anime", "Jogos", "História", "Geografia", "Animais", "Comida", "Artes Marciais", "Matemática"];
        const ptsLevels = [1, 4, 6, 8, 10];
        
        let state = {
            players: [],
            answered: [],
            currentTurn: 0,
            db: {},
            host: null
        };

        function initDb() {
            cats.forEach((cat, cIdx) => {
                ptsLevels.forEach((pts, pIdx) => {
                    state.db[`${cIdx}-${pIdx}`] = { question: `Pergunta de ${cat} valendo ${pts}?`, answer: `Resposta de ${cat}.`, image: "" };
                });
            });
        }

        function addPlayer() {
            const name = document.getElementById('player-input').value.trim().toUpperCase();
            if(name) {
                if(state.players.length === 0) state.host = name; // Primeiro é o dono
                state.players.push({ name, score: 0 });
                document.getElementById('player-input').value = '';
                updateLobby();
            }
        }

        function updateLobby() {
            const list = document.getElementById('player-list');
            list.innerHTML = state.players.map((p, i) => `
                <div class="flex justify-between bg-white/5 p-4 rounded-xl border border-white/10">
                    <span class="font-gamer ${i===0?'text-cyan-400':'text-white'}">${p.name} ${i===0?'(DONO)':''}</span>
                </div>
            `).join('');
            
            if(state.players.length > 0) {
                document.getElementById('start-btn').classList.remove('hidden');
                document.getElementById('wait-message').innerText = "Aguardando o Dono iniciar...";
            }
        }

        function startGame() {
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            initDb();
            renderGrid();
            renderScores();
            updateTurnIndicator();
        }

        function renderGrid() {
            const grid = document.getElementById('quiz-grid');
            grid.innerHTML = cats.map(c => `<div class="bg-black/40 p-4 text-center rounded-xl border-b-2 border-cyan-500 text-[10px] font-gamer text-cyan-500 uppercase">${c}</div>`).join('');
            ptsLevels.forEach((pts, pIdx) => {
                cats.forEach((_, cIdx) => {
                    const id = `${cIdx}-${pIdx}`;
                    const done = state.answered.includes(id);
                    grid.innerHTML += `<button onclick="handleCellClick('${id}')" ${done?'disabled':''} class="grid-cell py-10 rounded-xl text-3xl font-black text-white font-gamer">${pts}</button>`;
                });
            });
        }

        function renderScores() {
            const bar = document.getElementById('score-sidebar');
            bar.innerHTML = state.players.map((p, i) => `
                <div class="bg-white/5 px-6 py-4 rounded-2xl border border-white/10 min-w-[200px] flex flex-col flex-shrink-0 ${i === state.currentTurn ? 'active-turn' : ''}">
                    <span class="text-lg font-black text-slate-200 uppercase truncate">${p.name}</span>
                    <span class="text-3xl font-black font-gamer text-cyan-400">${p.score}</span>
                </div>
            `).join('');
        }

        function updateTurnIndicator() {
            const p = state.players[state.currentTurn];
            document.getElementById('turn-indicator').innerText = `VEZ DE: ${p.name}`;
        }

        function handleCellClick(id) {
            // Em um sistema real, aqui checaríamos se o seu ID de socket é o do currentTurn
            openQuestion(id);
        }

        function openQuestion(id) {
            activeId = id;
            const q = state.db[id];
            const [cIdx, pIdx] = id.split('-');
            document.getElementById('modal-category').innerText = cats[cIdx];
            document.getElementById('modal-points').innerText = `${ptsLevels[pIdx]} PTS`;
            document.getElementById('modal-question-text').innerText = q.question;
            document.getElementById('modal-answer-text').innerText = q.answer;
            document.getElementById('answer-box').classList.add('hidden');
            document.getElementById('player-actions').classList.add('hidden');
            document.getElementById('show-answer-btn').classList.remove('hidden');
            document.getElementById('question-modal').classList.remove('hidden');
        }

        function revealAnswer() {
            document.getElementById('answer-box').classList.remove('hidden');
            document.getElementById('show-answer-btn').classList.add('hidden');
            const container = document.getElementById('player-actions');
            container.innerHTML = state.players.map((p, i) => `
                <button onclick="award(${i})" class="bg-cyan-600 hover:bg-white p-4 rounded-xl font-black text-[10px] text-black uppercase">+ ${p.name}</button>
            `).join('') + `<button onclick="nextTurn()" class="bg-slate-800 p-4 rounded-xl font-black text-[10px] col-span-full uppercase">Ninguém acertou / Pular</button>`;
            container.classList.remove('hidden');
        }

        function award(pIdx) {
            const pts = ptsLevels[activeId.split('-')[1]];
            state.players[pIdx].score += pts;
            nextTurn(true);
        }

        function nextTurn(wasAnswered = false) {
            if(wasAnswered || activeId) state.answered.push(activeId);
            state.currentTurn = (state.currentTurn + 1) % state.players.length;
            document.getElementById('question-modal').classList.add('hidden');
            renderGrid();
            renderScores();
            updateTurnIndicator();
            if(state.answered.length >= (cats.length * ptsLevels.length)) showRanking();
        }

        function showRanking() {
            const list = document.getElementById('leaderboard');
            const sorted = [...state.players].sort((a,b) => b.score - a.score);
            list.innerHTML = sorted.map((p, i) => `
                <div class="flex items-center justify-between p-6 rounded-2xl ${i===0?'bg-yellow-500 text-black':'bg-white/5'}">
                    <span class="text-3xl font-black font-gamer">${i+1}º ${p.name}</span>
                    <span class="text-3xl font-black">${p.score}</span>
                </div>
            `).join('');
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
            document.getElementById('end-screen').classList.remove('hidden');
        }

        function cancelQuestion() { document.getElementById('question-modal').classList.add('hidden'); }
    </script>
</body>
</html>